{
  "task_id": "store_manager_20260218_role_os_bootstrap",
  "agent_identity": {
    "name": "StoreManager",
    "role": "WeChat Shop Operations and API Automation Manager",
    "methodology_version": "v1.2",
    "prompt_version": "v1.2",
    "json_version": "v1.2",
    "identity_prompt_path": "identity/store-manager/IDENTITY_PROMPT.md",
    "canon_path": "identity/STORE_MANAGER_CANON.md"
  },
  "objective": {
    "title": "Run stable listing and reject-recovery with event-first feedback",
    "priority": "HIGH",
    "status": "in_progress"
  },
  "state_machine": {
    "current_state": "doc_crosscheck",
    "allowed_states": [
      "intake",
      "doc_crosscheck",
      "preflight",
      "submit",
      "monitor",
      "reject_analysis",
      "repair",
      "resubmit",
      "done",
      "blocked_offline"
    ],
    "transition_rules": [
      "intake -> doc_crosscheck",
      "doc_crosscheck -> preflight",
      "preflight -> submit",
      "submit -> monitor",
      "monitor -> done",
      "monitor -> reject_analysis",
      "reject_analysis -> repair",
      "repair -> preflight",
      "reject_analysis -> blocked_offline"
    ]
  },
  "gates": {
    "document_gate": "required",
    "media_gate": "required",
    "category_compliance_gate": "required",
    "reject_memory_gate": "required",
    "protocol_baseline_review_gate": "required",
    "identity_update_gate": "required",
    "payload_evidence_gate": "required",
    "multimodal_consistency_gate": "required",
    "reasoning_loop_gate": "required",
    "routing_gate": "required",
    "rulebook_gate": "required",
    "agent_handoff_gate": "required"
  },
  "protocol_review_contract": {
    "required_before": [
      "identity_capability_upgrade",
      "identity_architecture_decision"
    ],
    "must_review_sources": [
      {
        "type": "github_repo_file",
        "repo": "brianlyang/identity-protocol",
        "path": "identity/protocol/IDENTITY_PROTOCOL.md"
      },
      {
        "type": "github_repo_file",
        "repo": "brianlyang/identity-protocol",
        "path": "docs/references/skill-installer-skill-creator-skill-update-lifecycle.md"
      },
      {
        "type": "github_repo_file",
        "repo": "brianlyang/identity-protocol",
        "path": "docs/references/skill-protocol-installer-creator-update-reference-v1.2.5.md"
      },
      {
        "type": "github_repo_file",
        "repo": "brianlyang/identity-protocol",
        "path": "docs/references/skill-mcp-tool-collaboration-contract-v1.0.md"
      },
      {
        "type": "github_repo_file",
        "repo": "brianlyang/identity-protocol",
        "path": "docs/research/IDENTITY_PROTOCOL_BENCHMARK_SKILLS_2026-02-19.md"
      },
      {
        "type": "official_doc",
        "url": "https://developers.openai.com/codex/skills/"
      },
      {
        "type": "official_doc",
        "url": "https://agentskills.io/specification"
      },
      {
        "type": "official_doc",
        "url": "https://modelcontextprotocol.io/specification/latest"
      }
    ],
    "required_evidence_fields": [
      "review_id",
      "reviewed_at",
      "reviewer_identity",
      "purpose",
      "sources_reviewed",
      "findings",
      "decision"
    ],
    "evidence_report_path_pattern": "identity/runtime/examples/protocol-baseline-review-*.json",
    "max_review_age_days": 7
  },
  "identity_update_lifecycle_contract": {
    "trigger_contract": {
      "mandatory_conditions": [
        "operational_failure",
        "repeat_failure",
        "route_exhausted",
        "new_domain_gap"
      ],
      "max_attempts_before_update": 2
    },
    "patch_surface_contract": {
      "required_files": [
        "CURRENT_TASK.json",
        "IDENTITY_PROMPT.md",
        "RULEBOOK.jsonl",
        "TASK_HISTORY.md"
      ],
      "required_file_paths": [
        "identity/store-manager/CURRENT_TASK.json",
        "identity/store-manager/IDENTITY_PROMPT.md",
        "identity/store-manager/RULEBOOK.jsonl",
        "identity/store-manager/TASK_HISTORY.md"
      ],
      "required_rulebook_update": true
    },
    "validation_contract": {
      "required_checks": [
        "scripts/validate_identity_runtime_contract.py",
        "scripts/validate_identity_upgrade_prereq.py",
        "scripts/validate_identity_update_lifecycle.py",
        "scripts/validate_identity_trigger_regression.py",
        "scripts/validate_identity_learning_loop.py",
        "scripts/validate_agent_handoff_contract.py"
      ],
      "must_pass_all": true
    },
    "replay_contract": {
      "replay_required": true,
      "replay_same_case_required": true,
      "replay_fail_action": "reenter_identity_update_loop",
      "evidence_path_pattern": "identity/runtime/examples/*update-replay*.json",
      "required_fields": [
        "identity_id",
        "replay_status",
        "patched_files",
        "validation_checks_passed"
      ]
    }
  },
  "trigger_regression_contract": {
    "required": true,
    "required_suites": [
      "positive_cases",
      "boundary_cases",
      "negative_cases"
    ],
    "result_enum": [
      "PASS",
      "FAIL"
    ],
    "sample_report_path_pattern": "identity/runtime/examples/*trigger-regression*.json",
    "fail_action": "block_merge_and_reenter_identity_update"
  },
  "evaluation_contract": {
    "required_evidence_triplet": [
      "api_evidence",
      "event_evidence",
      "ui_evidence"
    ],
    "consistency_required": true,
    "consistency_fail_action": "block_done_and_trigger_recheck",
    "run_report_path_pattern": "resource/reports/*run*.json"
  },
  "reasoning_loop_contract": {
    "max_attempts_before_escalation": 3,
    "mandatory_fields_per_attempt": [
      "attempt",
      "hypothesis",
      "patch",
      "expected_effect",
      "result"
    ],
    "failure_requires_next_action": true
  },
  "routing_contract": {
    "auto_route_enabled": true,
    "fallback_switch_after_failures": 2,
    "problem_type_routes": {
      "visual_quality": [
        "product-asset-bootstrap",
        "product-visual-qa",
        "weixinstore-ui-agent"
      ],
      "audit_reject_text": [
        "weixinstore-sku-onboarding"
      ],
      "offline_compliance_blocker": [
        "ops-notification-router"
      ],
      "capability_gap": [
        "identity-creator"
      ]
    }
  },
  "rulebook_contract": {
    "append_only": true,
    "required_rule_types": [
      "negative",
      "positive"
    ],
    "required_fields": [
      "rule_id",
      "type",
      "trigger",
      "action",
      "evidence_run_id",
      "scope",
      "confidence",
      "updated_at"
    ],
    "rulebook_path": "identity/store-manager/RULEBOOK.jsonl"
  },
  "learning_verification_contract": {
    "run_id_required": true,
    "reasoning_trace_required": true,
    "reasoning_trace_path_pattern": "resource/reports/*reasoning*.json",
    "rulebook_update_required": true,
    "rulebook_link_field": "evidence_run_id"
  },
  "agent_handoff_contract": {
    "required": true,
    "required_fields": [
      "handoff_id",
      "task_id",
      "from_agent",
      "to_agent",
      "input_scope",
      "actions_taken",
      "artifacts",
      "result",
      "next_action",
      "rulebook_update"
    ],
    "forbidden_mutations": [
      "gates",
      "protocol_review_contract",
      "identity_update_lifecycle_contract",
      "trigger_regression_contract"
    ],
    "handoff_log_path_pattern": "identity/runtime/logs/handoff/*.json",
    "minimum_logs_required": 1,
    "require_generated_at": true,
    "max_log_age_days": 30,
    "sample_log_path_pattern": "identity/runtime/examples/handoff",
    "result_enum": [
      "PASS",
      "FAIL",
      "BLOCKED"
    ],
    "self_test_required": true,
    "validator": "scripts/validate_agent_handoff_contract.py"
  },
  "source_of_truth": {
    "local_docs_roots": [
      "../webbrowser/restored/wechat-shop-docs-tree",
      "../webbrowser/restored/wechat-shop-docs"
    ],
    "local_project_evidence_roots": [
      "resource/ops-screens",
      "resource/reject-archive",
      "resource/push-events",
      "resource/preflight"
    ]
  },
  "escalation_policy": {
    "email_for_offline_only": true,
    "offline_blockers": [
      "qualification_application_required",
      "category_permission_application_required",
      "legal_certificate_collection_required",
      "account_permission_change_required"
    ],
    "do_not_email_for": [
      "routine_status_update",
      "normal_progress_report",
      "non_blocking_warning"
    ]
  },
  "required_artifacts": [
    "resource/payloads/*.json",
    "resource/preflight/*.json",
    "resource/preflight/*.md",
    "resource/reject-archive/*.json",
    "resource/reject-archive/*.md",
    "resource/reports/*.md"
  ],
  "post_execution_mandatory": [
    "append task outcome into identity/store-manager/TASK_HISTORY.md",
    "update objective.status",
    "update state_machine.current_state",
    "record next blocking dependency if any"
  ],
  "version_control": {
    "sync_status": "synchronized",
    "last_updated": "2026-02-20"
  }
}
